<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Design</title>

    <!-- Bootstrap: CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <!-- favicon -->
    <link rel="icon" href="../favicon.ico" />
  </head>

  <body class="d-flex flex-column h-100">
    <header class="bg-primary py-3 mb-3 position-relative">
      <div class="container col-lg-8">
        <a href="../">
          <h1 class="text-white">Automated API Validation Design</h1>
        </a>
      </div>
    </header>

    <main class="container col-lg-8">
      <section id="high-level-architecture">
        <h2>High Level Architecture</h2>
        <p>
          Below is a diagram of our high level architecture that describes how
          our action is used and run.
        </p>

        <img src="High_Level_Arch.png" class="img-fluid" />

        <p>A client API contains three special files:</p>
        <ol>
          <li>
            <b>OpenAPI Specification File</b> &mdash; This is a JSON or YAML
            file that complies with the OpenAPI specification. It describes the
            endpoints of API. For each endpoint, it describes the structure of
            the allowed inputs and expected responses of each endpoint. The full
            documentation for OpenAPI specifications is available at
            <a href="https://spec.openapis.org/oas/latest.html">OpenAPI</a>.
          </li>
          <li>
            <b>Step File</b> &mdash; This is a JSON or YAML file that describes
            how our action should test the API endpoints. Step files allow one
            to specify a series of requests, each called a "step", in testing
            one endpoint. The structure of this file is described in
            <a href="./guides/users#step-files-how-to"
              >How To Write a Step File</a
            >.
          </li>
          <li>
            <b>GitHub Action Workflow</b> &mdash; This is a YAML file that
            describes a job to be run by GitHub. The format of this file is
            described by
            <a href="https://docs.github.com/en/actions/quickstart"
              >GitHub Actions Quickstart</a
            >. This file should reference our action and provide any necessary
            parameters, as described in the
            <a href="./guides/users">User's Guide</a>.
          </li>
        </ol>

        <p>
          Our action runs inside a Docker container on a Linux x64 GitHub Action
          runner. Our action check out the client repo. It then runs some checks
          on the client's spec and step files. It then sends the requests
          described in the step file to the target API. Our action then
          validates the responses it receives against the expected response
          described in the spec file. Our action will then report the results in
          logs. For a detailed description of our action's behavior, see the
          <a href="#action-flowchart">Action Flowchart</a> for a detailed
          description of how our action behaves.
        </p>
      </section>

      <hr />

      <section id="action-flowchart">
        <h2>Action Flowchart</h2>
        <p>
          Below is a flowchart that describes in detail the steps our action
          takes when validating an API using spec and step files.
        </p>

        <img src="Flowchart.png" class="img-fluid" />

        <p>
          First, our action will check if the provided OpenAPI spec file is
          valid, meaning it complies with the OpenAPI specification. If not,
          then our action will immediately halt and report this error. Second,
          our action will check if the provided step file is valid according to
          our schema. If not, then our action will immediately halt and report
          this error. The next part depends on whether the step file provides a
          coverage threshold. If so, our action will measure the proportion of
          endpoints in the spec file that are tested by the step file. If the
          proportion is lower than the threshold, then our action will
          immediately halt and report this error, detailing which endpoints are
          not covered. Next, our action will being sending https requests
          described in the step file to the target API. For each response our
          action receives, it will validate it against the expected response
          described in the spec file. If any response does not match what is
          expected in the spec file, then our action will halt and report these
          discrepencies as errors. Otherwise, our action will report that the
          validation succeeded.
        </p>
      </section>

      <hr />

      <section id="class-diagram">
        <h2>Class Diagram</h2>
        <p>
          Below is a class diagram that describes the modules and functions in
          our action.
        </p>

        <img src="Class_Diagram.png" class="img-fluid" />

        <p>
          Here we'll describe what each of listed libraries (right) does. For a
          detailed description of every module and function, see our
          <a href="../_build/html/">documentation</a>.
        </p>
        <ul>
          <li>
            <b><a href="https://pypi.org/project/jschon/">Jschon</a></b> &mdash;
            This library allows us to validate if a given JSON instance is valid
            against a given JSON schema. We use this when checking if a step
            file is valid. We use then when checking if API responses match the
            schema provided in the spec file.
          </li>
          <li>
            <b><a href="https://pypi.org/project/requests/">Requests</a></b>
            &mdash; This library allows us to make HTTP requests. We use this
            library when sending requests described in the step file.
          </li>
          <li>
            <b><a href="https://pypi.org/project/PyYAML/">PyYAML</a></b> &mdash;
            This library allows us to parse YAML files. We use this library when
            parsing the spec file and step file.
          </li>
          <li>
            <b
              ><a href="https://pypi.org/project/openapi-spec-validator/"
                >OpenAPI Spec Validator</a
              ></b
            >
            &mdash; This library allows us to determine if a given YAML or JSON
            file is a valid instance of an OpenAPI specification. We use the
            library to validate the spec file.
          </li>
        </ul>
      </section>
    </main>

    <footer class="mt-auto py-4 bg-primary">
      <div class="container">
        <p class="m-0 text-center text-white">
          &copy; 2021 William Boyles, Savan Doshi, Manali Shirsekar, and Sheldon
          Yao
        </p>
      </div>
    </footer>
  </body>
</html>
